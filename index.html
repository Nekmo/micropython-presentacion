<!DOCTYPE html>

<html lang="es" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Micropython</title>
    <link rel="stylesheet" type="text/css" href="_static/revealjs/dist/reveal.css?v=d4488b42" />
    <link rel="stylesheet" href="_static/revealjs/dist/theme/.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/theme.css?v=4419f92b" />
    <script src="_static/main.js?v=dd9c77c2"></script>
    <link rel="next" title="Micropython: programaci√≥n f√°cil y para todos de microcontroladores" href="README.html" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  </head><body>
    <div class="reveal">
        <div class="slides" role="main">
            <div class="toctree-wrapper compound">
</div>
<section >
<section data-background-color="#36760d" data-transition-speed="slow" data-transition="fade" id="intro">
<h1>Micropython</h1>
<p><strong>Programaci√≥n f√°cil y para todos de microcontroladores</strong></p>
<aside class="notes">Hola a todos, muchas gracias por venir.</aside></section>
</section>
<section >
<section data-background-color="#090a0f" data-transition-speed="slow" data-transition="fade" id="sobre-mi-nekmo">
<h2>Sobre m√≠ <strong>Nekmo</strong></h2>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><a class="reference internal image-reference" href="_images/cara.svg"><img alt="_images/cara.svg" src="_images/cara.svg" style="width: 200px;" />
</a>
<p><em>Programador Python</em></p>
</td>
</tr>
</tbody>
</table>
<aside class="notes">Soy Juan Jos√©, aunque muchos me conocen en redes como Nekmo, y puede que me conozc√°is por charlas anteriores para Python M√°laga</aside></section>
</section>
<section >
<section data-background-color="#090a0f" id="otras-charlas">
<h2>Otras charlas...</h2>
<a class="reference internal image-reference" href="_images/talks1.jpg"><img alt="_images/talks1.jpg" class="align-center" src="_images/talks1.jpg" style="width: 32%;" />
</a>
<a class="reference internal image-reference" href="_images/talks2.jpg"><img alt="_images/talks2.jpg" class="align-center" src="_images/talks2.jpg" style="width: 32%;" />
</a>
<hr class="docutils" />
<a class="reference internal image-reference" href="_images/python-malaga-logo-white.png"><img alt="_images/python-malaga-logo-white.png" class="align-center" src="_images/python-malaga-logo-white.png" style="width: 10%;" />
</a>
<a class="reference internal image-reference" href="_images/plytix-logo-white.svg"><img alt="_images/plytix-logo-white.svg" class="align-center" src="_images/plytix-logo-white.svg" style="width: 35%;" />
</a>
<aside class="notes">Como la √∫ltima que tuvimos en Plytix, la empresa para la que trabajo, y que pod√©is encontrar disponible online.
Pero en esta ocasi√≥n, tendremos una charla un tanto diferente, aqu√≠ en OpenSouthCode...</aside></section>
</section>
<section >
<section data-background-color="#090a0f" id="id1">
<h2>Micropython</h2>
<a class="reference internal image-reference" href="_images/micropython-logo.svg"><img alt="_images/micropython-logo.svg" class="align-center" src="_images/micropython-logo.svg" style="width: 35%;" />
</a>
<aside class="notes">Vamos a hablar de microcontroladores y Micropython, un √°mbito seguramente diferente para muchos. Por ello, me
gustar√≠a saber cu√°ntos conoc√©is ya sobre este mundillo.</aside></section>
</section>
<section >
<section data-background-color="#000000" data-background-image="_images/microcontrollers_background.png" id="microcontroladores">
<h2>Microcontroladores</h2>
<aside class="notes">No os preocup√©is por los que no conozc√°is sobre este el tema, ya que iremos desde el principio.</aside></section>
<section data-background-color="#090a0f" id="que-son">
<h3>¬øQu√© son?</h3>
<ul class="simple">
<li class="fragment"><p><strong>Ventajas</strong></p>
<ul>
<li><p>ü§è Peque√±os</p></li>
<li><p>ü§ë Econ√≥micos</p></li>
<li><p>ü™´ Bajo consumo</p></li>
</ul>
</li>
<li class="fragment"><p><strong>Desventajas</strong></p>
<ul>
<li><p>üê¢ Poco potentes</p></li>
<li><p>üòì Programaci√≥n m√°s compleja</p></li>
</ul>
</li>
</ul>
<aside class="notes">Como os podr√©is imaginar por el nombre, los microcontroladores son peque√±os ordenadores, como puede ser una Raspberry
Pi, pero mucho m√°s peque√±os y con menos recursos. Entre sus ventajas tenemos [...] y entre sus desventajas [...].</aside></section>
<section data-background-color="#090a0f" id="algunos-usos">
<h3>Algunos <strong>usos</strong></h3>
<ul class="simple">
<li class="fragment"><p>‚òÅÔ∏è Dom√≥tica</p></li>
<li class="fragment"><p>ü§ñ Rob√≥tica</p></li>
<li class="fragment"><p>üîå Electr√≥nica</p></li>
<li class="fragment"><p>üöß Prototipos</p></li>
<li class="fragment"><p>...</p></li>
</ul>
<aside class="notes">Se utilizan en muchos √°mbitos, como la dom√≥tica, rob√≥tica, electr√≥nica, prototipos y muchos m√°s.</aside></section>
<section data-background-color="#333333" data-background-video="_images/robot_fall.mp4" data-background-video-loop="true" data-background-size="cover" id="gif-robot">
<h3>GIF robot</h3>
<aside class="notes">Gracias a ellos, podr√©is competir contra Boston Dynamics en rob√≥tica, y conseguir im√°genes graciosas como esta.</aside></section>
</section>
<section >
<section data-background-color="#090a0f" id="id2">
<h2>Micropython</h2>
<a class="reference internal image-reference" href="_images/micropython-logo.svg"><img alt="_images/micropython-logo.svg" class="align-center" src="_images/micropython-logo.svg" style="width: 35%;" />
</a>
<aside class="notes">Si record√°is, hemos dicho como uno de sus puntos d√©biles que son dif√≠ciles de programar. Y hasta hace no mucho era
as√≠. Pero desde hace unos a√±os, tenemos algunas soluciones como Micropython que nos permiten programar estos
microcontroladores de una forma m√°s sencilla. Micropython es una variante de Python 3 reducida y adaptada para
algunos de estos microcontroladores.</aside></section>
<section data-background-color="#090a0f" id="variantes">
<h3>Variantes</h3>
<ul class="simple">
<li class="fragment"><p><strong>ESP8266/ESP32</strong></p>
<ul>
<li><p>ü§ë Muy <strong>econ√≥mico</strong></p></li>
<li><p>üòÑ M√∫ltiples <strong>variantes</strong></p></li>
<li><p>üë• Gran <strong>comunidad</strong></p></li>
</ul>
</li>
<li class="fragment"><p><strong>Raspberry Pi Pico</strong></p>
<ul>
<li><p>üí∏ <strong>Econ√≥mico</strong></p></li>
<li><p>üî® Gran <strong>soporte</strong></p></li>
<li><p>üìö Bien <strong>documentado</strong></p></li>
</ul>
</li>
</ul>
<aside class="notes">Entre los microcontroladores que soportan Micropython podemos destacar los ESP8266 y ESP32 [...] o la Raspberry Pi Pico [...], u otros m√°s caros como la PyBoard, la oficial de Miccropython.</aside></section>
</section>
<section >
<section data-background-color="#000000" data-background-image="_images/esp32_background.jpg" id="esp32">
<h2>ESP32</h2>
<aside class="notes">Pero en esta presentaci√≥n vamos a utilizar un ESP32, porque sencillamente...</aside></section>
<section data-background-color="#333333" data-background-video="_images/empty_wallet.mkv" data-background-video-loop="true" data-background-size="cover" id="dinero">
<h3>Dinero</h3>
<aside class="notes">... la pela es la pela. Y es que son los m√°s econ√≥micos.</aside></section>
<section data-background-color="#090a0f" id="caracteristicas">
<h3>Caracter√≠sticas</h3>
<ul class="simple">
<li class="fragment"><p>üí™ <strong>Doble</strong> n√∫cleo</p></li>
<li class="fragment"><p>üõú Conectividad <strong>WiFi</strong></p></li>
<li class="fragment"><p>üì° Conectividad <strong>Bluetooth</strong></p></li>
<li class="fragment"><p>üîå M√∫ltiples pines <strong>GPIO</strong></p></li>
<li class="fragment"><p>üìü <strong>ADC</strong> / <strong>DAC</strong></p></li>
</ul>
<aside class="notes">Pero no s√≥lo es barato. Tambi√©n tiene un mont√≥n de caracter√≠sticas interesantes como [...]. Y todo ello partiendo
desde 3-4‚Ç¨.</aside></section>
<section data-background-color="#090a0f" id="primeros-pasos">
<h3><strong>Primeros</strong> pasos</h3>
<ul class="simple">
<li class="fragment"><p>‚ö° <strong>Flashear</strong> siguiendo la web de <a class="reference external" href="https://micropython.org/">Micropython</a></p></li>
<li class="fragment"><p>üìù <strong>IDE web</strong> <em>(ViperIDE)</em> o local <em>(Thonny)</em></p></li>
</ul>
<aside class="notes">Y empezar con Micropython es muy sencillo. S√≥lo ten√©is que descargar el binario del sitio web oficial, y flashearlo
mediante la herramienta indicado. Tras ello, pod√©is usar un IDE web como Viper IDE, o un IDE local como Thonny.</aside></section>
</section>
<section >
<section data-background-color="#333333" data-background-video="_images/resistor_fire.mp4" data-background-video-loop="true" data-background-size="cover" id="demos">
<h2>Demos</h2>
<aside class="notes">Y ya me voy callando, que seguro que lo que quer√©is ver son cosas en acci√≥n, y demos que luego no funcionar√°n.</aside></section>
</section>
<section >
<section data-background-color="#333333" data-background-video="_images/leds.mp4" data-background-video-loop="true" data-background-size="cover" id="encender-un-led">
<h2>Encender un <strong>led</strong></h2>
<aside class="notes">Vamos a empezar por lo m√°s sencillo de todo. Encender un led. El ejemplo m√°s t√≠pico de todos.</aside></section>
<section data-background-color="#DDDDDD" id="identificar-los-pines">
<h3>Identificar <strong>los pines</strong></h3>
<a class="reference internal image-reference" href="_images/datasheet.png"><img alt="_images/datasheet.png" src="_images/datasheet.png" style="width: 60%;" />
</a>
<aside class="notes">Aunque antes de empezar cualquier circuito, es imprescindible identificar los pines de nuestro controlador. Buscad
vuestro modelo y encontrar√©is un datasheet como este. Los pines GPIO, que suelen empezar por G o algo similar, son
los que nos interesan.</aside></section>
<section data-background-color="#DDDDDD" id="conectar-el-led">
<h3><strong>Conectar</strong> el led</h3>
<div  class="sphinx-contrib-video-container align-left"><video autoplay="True" controls="True" loop="True" muted="True" preload="auto"><source src="_images/sheet1.mkv" type=""></video></div><aside class="notes">Empezar con un led es tan sencillo como conectarlo en su polo positivo a un pin GPIO y el negativo a tierra.
Opcionalmente podemos a√±adir una resistencia para proteger el led, aunque no es imprescindible.</aside></section>
<section data-background-color="#090a0f" id="codigo-led">
<h3>C√≥digo <strong>led</strong></h3>

<div class="micropython-demo">
  <pre style="display: none;">
from machine import Pin
from time import sleep

led = Pin(1, Pin.OUT)

while True:
    led.on()
    sleep(0.5)
    led.off()
    sleep(0.5)
  </pre>
  
  <div>
  
    <div class="toolbar">
      <label for="font-size">Fuente:</label>
      <select class="font-size">
        <option>12</option>
        <option>14</option>
        <option>16</option>
        <option>18</option>
        <option selected>20</option>
        <option>24</option>
        <option>28</option>
        <option>32</option>
        <option>36</option>
        <option>40</option>
      </select>
    
      <label for="theme">Tema:</label>
      <select class="theme">
        <option value="vs">Claro</option>
        <option value="vs-dark" selected>Oscuro</option>
        <option value="hc-black">Alto contraste</option>
      </select>
    
      <span class="status-indicator"></span>
      <button class="connect">Conectar</button>
      <button class="send" disabled>‚ñ∂ Ejecutar</button>
      <button class="restart" disabled>Reiniciar</button>
      <button class="toggle-video">C√°mara</button>
    </div>
    
    <div class="container">
      <div class="editor"></div>
      <div class="resizer"></div>
      <div class="terminal"></div>
    </div>

  </div>
  
  <video controls class="micropython-demo-video" loop autoplay style="display: none;">
    <source src="_static/demo1.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
</div>
<aside class="notes">El c√≥digo fuente es tal que as√≠. En este ejemplo, haremos encender y apagarse el led en tiempos de medio segundo.
Como pod√©is observar, el c√≥digo es muy similar al Python de siempre, donde utilizamos la librer√≠a de GPIO para
definir qu√© pin, en este caso el GPIO 1, es el que queremos utilizar. Luego, lo inicializamos como salida. Tendremos
as√≠ una salida digital, es decir, binaria, que puede ser 0 o 1.</aside></section>
<section data-background-color="#090a0f" id="led-analogico">
<h3>Led <strong>anal√≥gico</strong></h3>

<div class="micropython-demo">
  <pre style="display: none;">
from machine import Pin, PWM
from time import sleep

led = PWM(Pin(1), freq=1000)

while True:
    for i in range(0, 1024, 10):
        led.duty(i)
        sleep(0.01)
    for i in range(1023, -1, -10):
        led.duty(i)
        sleep(0.01)
  </pre>
  
  <div>
  
    <div class="toolbar">
      <label for="font-size">Fuente:</label>
      <select class="font-size">
        <option>12</option>
        <option>14</option>
        <option>16</option>
        <option>18</option>
        <option selected>20</option>
        <option>24</option>
        <option>28</option>
        <option>32</option>
        <option>36</option>
        <option>40</option>
      </select>
    
      <label for="theme">Tema:</label>
      <select class="theme">
        <option value="vs">Claro</option>
        <option value="vs-dark" selected>Oscuro</option>
        <option value="hc-black">Alto contraste</option>
      </select>
    
      <span class="status-indicator"></span>
      <button class="connect">Conectar</button>
      <button class="send" disabled>‚ñ∂ Ejecutar</button>
      <button class="restart" disabled>Reiniciar</button>
      <button class="toggle-video">C√°mara</button>
    </div>
    
    <div class="container">
      <div class="editor"></div>
      <div class="resizer"></div>
      <div class="terminal"></div>
    </div>

  </div>
  
  <video controls class="micropython-demo-video" loop autoplay style="display: none;">
    <source src="_static/demo2.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
</div>
<aside class="notes">El ejemplo anterior funcionaba de forma digital. Es decir, que el led s√≥lo pod√≠a encenderse y apagarse. Pero si
utilizamos una salida anal√≥gica, indicada como PWM, podemos entregar m√°s valores, entre 0 y 1024, para as√≠ variar
la intensidad del led.</aside></section>
<section data-background-color="#333333" data-background-video="_images/house_leds.mp4" data-background-video-loop="true" data-background-size="cover" id="gif-luces-led">
<h3>GIF luces LED</h3>
<aside class="notes">Y ahora, ya sab√©is c√≥mo llenar vuestra casa de lucecitas LED.</aside></section>
</section>
<section >
<section data-background-color="#DDDDDD" id="conectar-un-boton">
<h2>Conectar <strong>un bot√≥n</strong></h2>
<div  class="sphinx-contrib-video-container align-left"><video autoplay="True" controls="True" loop="True" muted="True" preload="auto"><source src="_images/sheet3.mkv" type=""></video></div><aside class="notes">No s√≥lo podemos entregar valores de salida. Tambi√©n podemos leer valores de entrada, como es el caso de un bot√≥n.
La conexi√≥n es igualmente sencilla, pero no utilizaremos una resistencia, ya que el propio microcontrolador tiene una
resistencia pull-up interna. Si quer√©is m√°s detalles al respecto, me pod√©is preguntar al finalizar la charla. Y as√≠
ya os dejo una pregunta para el final.</aside></section>
<section data-background-color="#090a0f" id="codigo-boton">
<h3><strong>C√≥digo</strong> bot√≥n</h3>

<div class="micropython-demo">
  <pre style="display: none;">
from machine import Pin
from time import sleep

button = Pin(1, Pin.IN, Pin.PULL_UP)

while True:
    state = not button.value()
    print(int(state))
    sleep(0.1)
  </pre>
  
  <div>
  
    <div class="toolbar">
      <label for="font-size">Fuente:</label>
      <select class="font-size">
        <option>12</option>
        <option>14</option>
        <option>16</option>
        <option>18</option>
        <option selected>20</option>
        <option>24</option>
        <option>28</option>
        <option>32</option>
        <option>36</option>
        <option>40</option>
      </select>
    
      <label for="theme">Tema:</label>
      <select class="theme">
        <option value="vs">Claro</option>
        <option value="vs-dark" selected>Oscuro</option>
        <option value="hc-black">Alto contraste</option>
      </select>
    
      <span class="status-indicator"></span>
      <button class="connect">Conectar</button>
      <button class="send" disabled>‚ñ∂ Ejecutar</button>
      <button class="restart" disabled>Reiniciar</button>
      <button class="toggle-video">C√°mara</button>
    </div>
    
    <div class="container">
      <div class="editor"></div>
      <div class="resizer"></div>
      <div class="terminal"></div>
    </div>

  </div>
  
  <video controls class="micropython-demo-video" loop autoplay style="display: none;">
    <source src="_static/demo3.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
</div>
<aside class="notes">Tenemos algo muy similar al led, pero en este caso el pin como entrada, y hemos configurado el pull-up interno.
Gracias al pull-up, protegeremos el pin de cortocircuitos, pero debemos tener en cuenta que por ello tendremos valor
1 cuando el bot√≥n no est√© presionado, y valor 0 cuando s√≠ lo est√©.</aside></section>
<section data-background-color="#333333" data-background-video="_images/arcades.mp4" data-background-video-loop="true" data-background-size="cover" id="gif-recreativa">
<h3>GIF recreativa</h3>
<aside class="notes">Con esto, ya est√°is capacitados para crear vuestra propia recreativa con todos los botones que quer√°is.</aside></section>
</section>
<section >
<section data-background-color="#DDDDDD" id="conectar-un-led-rgb">
<h2>Conectar un <strong>LED RGB</strong></h2>
<div  class="sphinx-contrib-video-container align-left"><video autoplay="True" controls="True" loop="True" muted="True" preload="auto"><source src="_images/sheet4.mkv" type=""></video></div><aside class="notes">Y para vuestra recreativa, no pueden faltar LEDs RGB a todo color. Como muchos sabr√©is, las siglas de RGB proceden de
Red, Green y Blue, que son los colores primarios de la luz. Cada uno de estos colores corresponder√° a un pin GPIO,
por lo que necesitaremos tres pines, y un cuarto pin para tierra.</aside></section>
<section data-background-color="#090a0f" id="codigo-led-rgb">
<h3><strong>C√≥digo</strong> LED RGB</h3>

<div class="micropython-demo">
  <pre style="display: none;">
from machine import Pin, PWM
from time import sleep
import urandom

r = PWM(Pin(1), freq=1000)
g = PWM(Pin(2), freq=1000)
b = PWM(Pin(3), freq=1000)

def set_color(red, green, blue):
    r.duty(red)
    g.duty(green)
    b.duty(blue)

while True:
    red = urandom.getrandbits(10)
    green = urandom.getrandbits(10)
    blue = urandom.getrandbits(10)
    set_color(red, green, blue)
    sleep(1)
  </pre>
  
  <div>
  
    <div class="toolbar">
      <label for="font-size">Fuente:</label>
      <select class="font-size">
        <option>12</option>
        <option>14</option>
        <option>16</option>
        <option>18</option>
        <option selected>20</option>
        <option>24</option>
        <option>28</option>
        <option>32</option>
        <option>36</option>
        <option>40</option>
      </select>
    
      <label for="theme">Tema:</label>
      <select class="theme">
        <option value="vs">Claro</option>
        <option value="vs-dark" selected>Oscuro</option>
        <option value="hc-black">Alto contraste</option>
      </select>
    
      <span class="status-indicator"></span>
      <button class="connect">Conectar</button>
      <button class="send" disabled>‚ñ∂ Ejecutar</button>
      <button class="restart" disabled>Reiniciar</button>
      <button class="toggle-video">C√°mara</button>
    </div>
    
    <div class="container">
      <div class="editor"></div>
      <div class="resizer"></div>
      <div class="terminal"></div>
    </div>

  </div>
  
  <video controls class="micropython-demo-video" loop autoplay style="display: none;">
    <source src="_static/demo4.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
</div>
<aside class="notes">El c√≥digo es muy similar al que utilizamos antes con un led normal en modo anal√≥gico, pero en este caso tenemos 3
pines, como si tuvi√©semos 3 leds diferentes, aunque en realidad est√°n encapsulados en uno solo. Este c√≥digo genera
colores aleatorios, con valores 0 y 1024 para cada uno.</aside></section>
<section data-background-color="#333333" data-background-video="_images/cables.mp4" data-background-video-loop="true" data-background-size="cover" id="gif-cientos-de-cables">
<h3>GIF cientos de cables</h3>
<aside class="notes">Pero claro, si quisi√©semos tener varios leds RGB, cada uno con su color, necesitar√≠amos un mont√≥n de cables y ocupar
todos los pines GPIO de nuestra placa, los cuales son muy valiosos. Para ello disponemos de protocolos de
comunicaci√≥n, que nos permiten comunicarnos con varios dispositivos a la vez.</aside></section>
</section>
<section >
<section data-background-color="#090a0f" id="protocolos-de-comunicacion">
<h2><strong>Protocolos</strong> de comunicaci√≥n</h2>
<ul class="simple">
<li class="fragment"><p>1Ô∏è‚É£ <strong>OneWire</strong> (1 pin)</p></li>
<li class="fragment"><p>2Ô∏è‚É£ <strong>I2C</strong> (2 pines)</p></li>
<li class="fragment"><p>3Ô∏è‚É£ <strong>SPI</strong> (3/4+ pines)</p></li>
<li class="fragment"><p>üìü <strong>UART</strong> (2+ pines)</p></li>
</ul>
<aside class="notes">Disponemos de diferentes protocolos de comunicaci√≥n, que suelen variar en el n√∫mero de pines, en su velocidad,
su uso, etc. Por ejemplo, oneWire s√≥lo llega a necesitar un pin, pero es muy lento. I2C s√≥lo necesita 2 pines, siendo
muy popular. SPI parte de 3 a 4 pines, pudiendo requerir m√°s si tenemos varios dispositivos. UART, que algunos
recordar√©is de los serial bus, parte de 2 pines... y as√≠ podr√≠amos continuar. Tambi√©n tenemos protocolos espec√≠ficos
y dise√±ados para casos concretos, como el que veremos ahora. Recordad que con cada protocolo, necesitaremos utilizar
adicionalmente una tierra, que no se cuenta como pin de comunicaci√≥n.</aside></section>
</section>
<section >
<section data-background-color="#DDDDDD" id="conectar-un-led-ws2812">
<h2>Conectar un <strong>led WS2812</strong></h2>
<div  class="sphinx-contrib-video-container align-left"><video autoplay="True" controls="True" loop="True" muted="True" preload="auto"><source src="_images/sheet5.mkv" type=""></video></div><aside class="notes">Vamos a empezar con el protocolo WS2812, que es el que utilizan los LEDs RGB de tipo NeoPixel. Este protocolo
unidireccional s√≥lo necesita un pin de datos, pudiendo conectar varios LEDs a la vez, cada uno con su color. Tenemos
como cables adicionales el de tierra y el de alimentaci√≥n, que en este caso es de 5V.</aside></section>
<section data-background-color="#090a0f" id="codigo-led-ws2812">
<h3><strong>C√≥digo</strong> LED WS2812</h3>

<div class="micropython-demo">
  <pre style="display: none;">
import apa106
from machine import Pin
from time import sleep

NUM_LEDS = 3
PIN_NUM = 1

leds = apa106.APA106(Pin(PIN_NUM), NUM_LEDS)
colors = [(255, 0, 0), (0, 255, 0), (0, 0, 255)]
positions = list(range(NUM_LEDS))

while True:
    for i in range(NUM_LEDS):
        leds[i] = colors[positions[i]]
    leds.write()
    positions = [(pos + 1) % NUM_LEDS for pos in positions]
    sleep(0.5)
  </pre>
  
  <div>
  
    <div class="toolbar">
      <label for="font-size">Fuente:</label>
      <select class="font-size">
        <option>12</option>
        <option>14</option>
        <option>16</option>
        <option>18</option>
        <option selected>20</option>
        <option>24</option>
        <option>28</option>
        <option>32</option>
        <option>36</option>
        <option>40</option>
      </select>
    
      <label for="theme">Tema:</label>
      <select class="theme">
        <option value="vs">Claro</option>
        <option value="vs-dark" selected>Oscuro</option>
        <option value="hc-black">Alto contraste</option>
      </select>
    
      <span class="status-indicator"></span>
      <button class="connect">Conectar</button>
      <button class="send" disabled>‚ñ∂ Ejecutar</button>
      <button class="restart" disabled>Reiniciar</button>
      <button class="toggle-video">C√°mara</button>
    </div>
    
    <div class="container">
      <div class="editor"></div>
      <div class="resizer"></div>
      <div class="terminal"></div>
    </div>

  </div>
  
  <video controls class="micropython-demo-video" loop autoplay style="display: none;">
    <source src="_static/demo5.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
</div>
<aside class="notes">En este c√≥digo utilizaremos el m√≥dulo apa106, incluido de serie en Micropython. Este m√≥dulo incluye ya el protocolo
de comunicaci√≥n WS2812, por lo que lo √∫nico que tendremos que hacer es definir el n√∫mero de LEDs y el pin de datos.
Rotaremos los colores RGB de cada entre cada uno de los LEDs.</aside></section>
</section>
<section >
<section data-background-image="_images/i2c_background.png" data-background-size="cover" id="i2c">
<h2><strong>I2C</strong></h2>
<aside class="notes">Aunque el protocolo WS2812 nos permite controlar m√∫ltiples LEDs individualmente con un solo cable, es un protocolo
unidireccional dise√±ado en exclusiva para LEDs. En cambio, tenemos otros protocolos como I2C, que nos permiten
comunicarnos con otros dispositivos, como pantallas, sensores, etc. Es un protocolo bidireccional que como dijimos
antes, s√≥lo necesita 2 pines.</aside></section>
</section>
<section >
<section data-background-color="#DDDDDD" id="conectar-sensor-y-pantalla-i2c">
<h2>Conectar <strong>sensor</strong> y <strong>pantalla I2C</strong></h2>
<div  class="sphinx-contrib-video-container align-left"><video autoplay="True" controls="True" loop="True" muted="True" preload="auto"><source src="_images/sheet6.mkv" type=""></video></div><aside class="notes">Vamos a conectar tanto la pantalla como un sensor de temperatura a un mismo I2C, el cual utiliza 2 pines, SDA y SCL.
Necesitaremos adem√°s una tierra y una alimentaci√≥n. Cada dispositivo I2C tiene una direcci√≥n √∫nica, la cual debemos
conocer para comunicarnos con √©l. No obstante, podemos utilizar el esc√°ner I2C para conocer la direcci√≥n de nuestros
dispositivos. En este caso, la pantalla es una OLED de 128x64 p√≠xeles, y el sensor un SHT41 para medir la temperatura
y humedad.</aside></section>
<section data-background-color="#090a0f" id="codigo-sensor-y-pantalla-i2c">
<h3><strong>C√≥digo</strong> sensor y pantalla I2C</h3>

<div class="micropython-demo">
  <pre style="display: none;">
from machine import Pin, I2C
from time import sleep
import ssd1306
import sht4x

i2c = I2C(0, scl=Pin(1), sda=Pin(2))
print(i2c.scan())
oled = ssd1306.SSD1306_I2C(128, 64, i2c, 0x3C)
sensor = sht4x.SHT4X(i2c, 0x44)

while True:
    temperature, humidity = sensor.measurements
    oled.fill(0)
    oled.text("Temp: {:.1f} C".format(temperature), 0, 0)
    oled.text("Hum:  {:.1f} %".format(humidity), 0, 20)
    oled.show()
    sleep(2)
  </pre>
  
  <div>
  
    <div class="toolbar">
      <label for="font-size">Fuente:</label>
      <select class="font-size">
        <option>12</option>
        <option>14</option>
        <option>16</option>
        <option>18</option>
        <option selected>20</option>
        <option>24</option>
        <option>28</option>
        <option>32</option>
        <option>36</option>
        <option>40</option>
      </select>
    
      <label for="theme">Tema:</label>
      <select class="theme">
        <option value="vs">Claro</option>
        <option value="vs-dark" selected>Oscuro</option>
        <option value="hc-black">Alto contraste</option>
      </select>
    
      <span class="status-indicator"></span>
      <button class="connect">Conectar</button>
      <button class="send" disabled>‚ñ∂ Ejecutar</button>
      <button class="restart" disabled>Reiniciar</button>
      <button class="toggle-video">C√°mara</button>
    </div>
    
    <div class="container">
      <div class="editor"></div>
      <div class="resizer"></div>
      <div class="terminal"></div>
    </div>

  </div>
  
  <video controls class="micropython-demo-video" loop autoplay style="display: none;">
    <source src="_static/demo6.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
</div>
<aside class="notes">Para este c√≥digo, hemos tenido que instalar 2 m√≥dulos adicionales, para lo cual pod√©is usar upip, el gestor de
paquetes de Micropython. Hemos instalado el m√≥dulo ssd1306 para la pantalla, y el m√≥dulo sht4x para el sensor.
Tenemos como direcciones para los dispositivos la 0x3C para la pantalla y la 0x44 para el sensor.</aside></section>
</section>
<section >
<section data-background-image="_images/wireless_background.png" data-background-size="cover" id="wifi-y-bluetooth">
<h2><strong>WiFi</strong> y <strong>bluetooth</strong></h2>
<aside class="notes">Pero no s√≥lo disponemos de protocolos de comunicaci√≥n al√°mbrica. En controladores como el ESP32 disponemos de Wifi,
Bluetooth, y algunos modelos Zigbee.</aside></section>
<section data-background-color="#090a0f" id="codigo-coche">
<h3><strong>C√≥digo</strong> coche</h3>

<div class="micropython-demo">
  <pre style="display: none;">
import json
import time
import network
import web
from hardware import I2C
from hardware import Pin
from web import WebSocket
import uasyncio as asyncio

i2c0 = I2C(0, scl=Pin(26), sda=Pin(0), freq=400000)
i2c0.writeto_mem(0x38, 0x00, bytearray([0, 0, 0, 0]))

ap = network.WLAN(network.AP_IF)
ap.active(True)
ap.config(essid='roverc.pro', password='roverc.pro', authmode=network.AUTH_WPA_WPA2_PSK)

while not ap.active():
    time.sleep(1)

ip = ap.ifconfig()[0]
print('IP:', ip)

app = web.App(host='0.0.0.0', port=80)


def normalize_value(value: int | float) -> bytes:
    value = int(value)
    if value >= 128:
        value = 127  # The maximum value in positive is 127
    if value < 0:
        value = (256 + value)
    return value.to_bytes(1, "big")


def coords_to_mecano_wheels(x: int, y: int, maximum: int = 127):
    r1 = x + y
    r2 = -x + y
    r3 = -x + y
    r4 = x + y
    values = [r1, r2, r3, r4]
    max_val = max(abs(v) for v in values)
    if max_val > maximum:
        factor = maximum / max_val
        values = [v * factor for v in values]
    return [normalize_value(v) for v in values]


async def serve_static(w, filename, mimetype):
    # write http headers
    w.write('HTTP/1.0 200 OK\r\n')
    w.write(f'Content-Type: {mimetype}; charset=utf-8\r\n')
    w.write('\r\n')
    # write page body
    with open(filename, 'r') as f:
        w.write(f.read())
    # drain stream buffer
    await w.drain()


# root route handler
@app.route('/')
async def handler(r, w):
    return await serve_static(w, "index.html", "text/html")


# root route handler
@app.route('/joy.min.js')
async def serve_script(r, w):
    return await serve_static(w, "joy.min.js", "application/javascript")


# /ws WebSocket route handler
@app.route('/ws')
async def ws_handler(r, w):
    # upgrade connection to WebSocket
    ws = await WebSocket.upgrade(r, w)
    latest = None
    while True:
        evt = await ws.recv()
        if evt is None or evt['type'] == 'close':
            # handle closed stream/close event
            break
        elif evt['type'] == 'text':
            # print received messages and echo them
            print('Received:', evt['data'])
            data = json.loads(evt['data'])
            if "x" in data and "y" in data:
                x, y = data['x'], data['y']
                if (x, y) == latest:
                    continue
                try:
                    wheel1, wheel2, wheel3, wheel4 = coords_to_mecano_wheels(x, y)
                except OverflowError:
                    continue
                print("Wheels:", *(w[0] for w in (wheel1, wheel2, wheel3, wheel4)))
                i2c0.writeto_mem(0x38, 0x00, b"".join([wheel1, wheel2, wheel3, wheel4]))
                latest = x, y
            elif "claw" in data:
                value = 8 if data["claw"] else 87
                i2c0.writeto_mem(0x38, 0x10, value.to_bytes(1, 'big'))


# Start event loop and create server task
loop = asyncio.get_event_loop()
loop.create_task(app.serve())
loop.run_forever()
  </pre>
  
  <div>
  
    <div class="toolbar">
      <label for="font-size">Fuente:</label>
      <select class="font-size">
        <option>12</option>
        <option>14</option>
        <option>16</option>
        <option>18</option>
        <option selected>20</option>
        <option>24</option>
        <option>28</option>
        <option>32</option>
        <option>36</option>
        <option>40</option>
      </select>
    
      <label for="theme">Tema:</label>
      <select class="theme">
        <option value="vs">Claro</option>
        <option value="vs-dark" selected>Oscuro</option>
        <option value="hc-black">Alto contraste</option>
      </select>
    
      <span class="status-indicator"></span>
      <button class="connect">Conectar</button>
      <button class="send" disabled>‚ñ∂ Ejecutar</button>
      <button class="restart" disabled>Reiniciar</button>
      <button class="toggle-video">C√°mara</button>
    </div>
    
    <div class="container">
      <div class="editor"></div>
      <div class="resizer"></div>
      <div class="terminal"></div>
    </div>

  </div>
  
  <video controls class="micropython-demo-video" loop autoplay style="display: none;">
    <source src="_static/demo7.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
</div>
<aside class="notes">En este √∫ltimo ejemplo no me voy a extender mucho. Inicializamos un access point, y un servidor web con soporte para
websockets, el cual permite conectarnos al coche y controlarlo desde el navegador.</aside></section>
<section data-background-color="#DDDDDD" id="demo-coche">
<h3>Demo <strong>coche</strong></h3>
<iframe src="http://192.168.4.1/" height="600px" width="100%" style="border: 0;"></iframe><aside class="notes">¬°Ahora, vamos a ver el coche en acci√≥n!</aside></section>
<section data-background-color="#DDDDDD" id="pruebalo-tu-mismo">
<h3>¬°Pru√©balo t√∫ mismo!</h3>
<ul class="simple">
<li><p><strong>SSID:</strong> roverc.pro</p></li>
<li><p><strong>Password:</strong> roverc.pro</p></li>
<li><p><strong>Url:</strong> <a class="reference external" href="http://192.168.4.1">http://192.168.4.1</a></p></li>
</ul>
<aside class="notes">Y por si os sabe a poco, ¬°os invito a probarlo vosotros mismos! Conectad vuestro m√≥vil al wifi del coche, y acceded a
la direcci√≥n indicada.</aside></section>
</section>
<section >
<section data-background-gradient="linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);" id="muchas-gracias-a-todos">
<h2>¬°Muchas gracias a todos!</h2>
<aside class="notes">Y mientras os dejo jugando con el coche... ¬°Hasta aqu√≠ la presentaci√≥n! Espero que hay√°is disfrutado y aprendido
algo nuevo. S√© que he ido muy r√°pido, pero si ten√©is dudas, estoy disponible para resolverlas.</aside></section>
</section>
<section >
<section data-background-color="#333333" data-transition-speed="default" data-transition="fade" id="recursos">
<h2>Recursos</h2>
<ul class="simple">
<li class="fragment"><p>üåê <strong>Web oficial</strong>: <a class="reference external" href="https://micropython.org">https://micropython.org</a></p></li>
<li class="fragment"><p>üìù <strong>Editor online</strong>: <a class="reference external" href="https://viper-ide.org">https://viper-ide.org</a></p></li>
<li class="fragment"><p>ü•Ω <strong>Simulador online</strong>: <a class="reference external" href="https://wokwi.com">https://wokwi.com</a></p></li>
</ul>
<aside class="notes">Os dejo aqu√≠ disponibles estos recursos, para empezar a trabajar con Micropython.</aside></section>
</section>
<section >
<section data-background-color="#4973ff" data-transition-speed="slow" data-transition="fade" id="qr">
<h2>QR</h2>
<a class="reference internal image-reference" href="_images/qr.svg"><img alt="_images/qr.svg" src="_images/qr.svg" style="width: 60%;" />
</a>
<aside class="notes">Y por supuesto, tambi√©n ten√©is esta misma presentaci√≥n, con los ejemplos de c√≥digo y los diagramas.</aside></section>
</section>
<section >
<section data-background-color="#4973ff" data-transition-speed="slow" data-transition="fade" id="python-malaga">
<h2>Python <strong>M√°laga</strong></h2>
<ul class="simple">
<li><p>üåê <strong>Sitio web:</strong> <a class="reference external" href="https://www.python-malaga.es/">python-malaga.es</a>.</p></li>
<li><p>ü§ù <strong>Meetup:</strong> <a class="reference external" href="https://www.meetup.com/Python-Malaga/">meetup.com/Python-Malaga</a>.</p></li>
<li><p>üê¶ <strong>Twitter:</strong> <a class="reference external" href="https://twitter.com/python_malaga">&#64;python_malaga</a>.</p></li>
<li><p>‚Äçüíº <strong>LinkedIn:</strong> <a class="reference external" href="https://www.linkedin.com/groups/13110576/">linkedin.com/groups/13110576</a>.</p></li>
<li><p>üì± <strong>Telegram:</strong> <a class="reference external" href="https://t.me/python_malaga">python_malaga</a>.</p></li>
</ul>
<aside class="notes">Y para m√°s presentaciones, apuntaros a la comunidad de Python M√°laga, donde hacemos m√°s charlas como esta. No
olvid√©is seguirnos en nuestras redes sociales, y en nuestro grupo de Telegram.</aside></section>
<section data-background-color="#333333" data-transition-speed="default" data-transition="fade" id="contactar">
<h3><strong>Contactar</strong></h3>
<ul class="simple">
<li><p>üåê <strong>Sitio web:</strong> <a class="reference external" href="https://nekmo.com">nekmo.com</a></p></li>
<li><p>üì´ <strong>Email:</strong> <a class="reference external" href="mailto:contacto&#37;&#52;&#48;nekmo&#46;com">contacto<span>&#64;</span>nekmo<span>&#46;</span>com</a></p></li>
<li><p>üê¶ <strong>Twitter:</strong> <a class="reference external" href="https://twitter.com/nekmocom">&#64;nekmocom</a></p></li>
<li><p>üì± <strong>Telegram:</strong> <a class="reference external" href="https://t.me/nekmo">&#64;nekmo</a></p></li>
<li><p>üí° <strong>Jabber:</strong> <a class="reference external" href="xmpp://nekmo&#64;nekmo.org">nekmo&#64;nekmo.org</a></p></li>
</ul>
<aside class="notes">A cualquier cosa, ten√©is mi contacto disponible.</aside></section>
</section>

        </div>
    </div>
    
    <script src="_static/revealjs/dist/reveal.js"></script>
    
    
      <script src="_static/revealjs/plugin/notes/notes.js"></script>
      <script src="_static/revealjs/plugin/highlight/highlight.js"></script>
      
    
    <script>
        var revealjsConfig = new Object();
        Object.assign(revealjsConfig, {"controls": true, "progress": true, "history": true, "center": true, "margin": 0.2, "transition": "slide", "scrollActivationWidth": null});
        
        
        
          revealjsConfig.plugins = [
            RevealNotes,RevealHighlight,
          ];
        
        // More info https://github.com/hakimel/reveal.js#configuration
        Reveal.initialize(revealjsConfig);
    </script>

  </body>
</html>